<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turing Machine with Binary Conversion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .tape-cell {
            min-width: 44px;
            height: 44px;
            border: 1px solid #4b5563;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Fira Code', monospace;
            font-weight: 500;
            font-size: 1.1rem;
            transition: all 0.2s ease-in-out;
            background-color: #1f2937;
        }
        .tape-cell.active {
            background-color: #3b82f6;
            color: #ffffff;
            transform: scale(1.1);
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        #rules {
            font-family: 'Fira Code', monospace;
            background-color: #1f2937;
            border: 1px solid #4b5563;
            color: #d1d5db;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white">Turing Machine</h1>
            <p class="text-lg text-gray-400 mt-2">With Binary Input Conversion</p>
        </header>

        <main>
            <!-- Rules Definition -->
            <div class="card p-6 rounded-lg shadow-lg mb-8">
                <h2 class="text-2xl font-semibold text-white mb-4">1. Define Transition Rules</h2>
                <p class="text-sm text-gray-400 mb-4">Example below is for a binary incrementer. It moves right, then flips bits from right to left.</p>
                <textarea id="rules" class="w-full h-48 p-3 rounded-md" spellcheck="false">
q_right,0,q_right,0,R
q_right,1,q_right,1,R
q_right,B,q_carry,B,L
q_carry,1,q_carry,0,L
q_carry,0,q_accept,1,N
q_carry,B,q_accept,1,N
                </textarea>
            </div>

            <!-- Input and Controls -->
            <div class="card p-6 rounded-lg shadow-lg mb-8">
                <h2 class="text-2xl font-semibold text-white mb-4">2. Provide Input &amp; Run</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="tapeInput" class="block text-sm font-medium text-gray-300 mb-2">Initial Tape Input</label>
                        <input type="text" id="tapeInput" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white" value="1011">
                    </div>
                    <div>
                        <label for="initialState" class="block text-sm font-medium text-gray-300 mb-2">Initial State</label>
                        <input type="text" id="initialState" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white" value="q_right">
                    </div>
                </div>
                <div class="flex flex-wrap gap-3 justify-center">
                    <button id="initButton" class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Initialize</button>
                    <button id="binaryButton" class="btn bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Convert to Binary</button>
                    <button id="runButton" class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg" disabled>Run</button>
                    <button id="stepButton" class="btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg" disabled>Step</button>
                    <button id="resetButton" class="btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg" disabled>Reset</button>
                </div>
            </div>

            <!-- Machine State Display -->
            <div class="card p-4 rounded-lg shadow-lg mb-8 text-center">
                 <p class="text-lg">Current State: <span id="currentStateDisplay" class="font-mono font-bold text-green-400">N/A</span> | Steps: <span id="stepCountDisplay" class="font-mono font-bold text-green-400">0</span></p>
            </div>

            <!-- Tape Display -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-white mb-4 text-center">Tape</h2>
                <div class="flex justify-center items-center bg-gray-900 p-4 rounded-lg overflow-x-auto w-full">
                    <div id="tape" class="flex justify-center items-center"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- DOM Elements ---
        const tapeInput = document.getElementById('tapeInput');
        const initialStateInput = document.getElementById('initialState');
        const initButton = document.getElementById('initButton');
        const binaryButton = document.getElementById('binaryButton'); // New button
        const runButton = document.getElementById('runButton');
        const stepButton = document.getElementById('stepButton');
        const resetButton = document.getElementById('resetButton');
        const tapeContainer = document.getElementById('tape');
        const rulesTextarea = document.getElementById('rules');
        const currentStateDisplay = document.getElementById('currentStateDisplay');
        const stepCountDisplay = document.getElementById('stepCountDisplay');

        // --- Turing Machine State ---
        let tape = [];
        let headPosition = 0;
        let currentState = '';
        let rules = {};
        let initialTapeString = '';
        let initialMachineState = '';
        let stepCount = 0;
        let running = false;
        let runInterval = null;

        // --- Core Functions ---

        function initialize() {
            stopRun();
            parseRules();
            initialTapeString = tapeInput.value;
            tape = initialTapeString.split('');
            if (tape.length === 0) tape = ['B'];
            headPosition = 0;
            currentState = initialStateInput.value;
            initialMachineState = currentState;
            stepCount = 0;
            updateDisplay();
            runButton.disabled = false;
            stepButton.disabled = false;
            resetButton.disabled = false;
        }
        
        function parseRules() {
            rules = {};
            const lines = rulesTextarea.value.trim().split('\n');
            lines.forEach(line => {
                const parts = line.trim().split(',');
                if (parts.length === 5) {
                    const [state, read, newState, write, move] = parts;
                    if (!rules[state]) rules[state] = {};
                    rules[state][read] = { newState, write, move: move.toUpperCase() };
                }
            });
        }

        /**
         * NEW FUNCTION: Converts the input text to its binary representation.
         */
        function convertInputToBinary() {
            const inputString = tapeInput.value;
            if (inputString.length === 0) {
                alert("Input field is empty. Nothing to convert.");
                return;
            }

            let binaryString = '';
            for (let i = 0; i < inputString.length; i++) {
                // Get ASCII code, convert to binary, and pad to 8 bits
                binaryString += inputString[i].charCodeAt(0).toString(2).padStart(8, '0');
            }

            // Update the input field with the new binary string
            tapeInput.value = binaryString;
            // Re-initialize the machine with the new tape
            initialize();
        }

        function step() {
            if (currentState.toLowerCase().includes('accept') || currentState.toLowerCase().includes('halt')) {
                stopRun();
                return;
            }

            const readSymbol = tape[headPosition] || 'B';
            const rule = rules[currentState] ? rules[currentState][readSymbol] : null;

            if (rule) {
                tape[headPosition] = rule.write;
                currentState = rule.newState;
                if (rule.move === 'R') {
                    headPosition++;
                    if (headPosition === tape.length) tape.push('B'); 
                } else if (rule.move === 'L') {
                    headPosition--;
                    if (headPosition < 0) {
                        tape.unshift('B'); 
                        headPosition = 0;
                    }
                }
                stepCount++;
            } else {
                stopRun();
            }
            updateDisplay();
        }

        function run() {
            if (running) return;
            running = true;
            runButton.textContent = 'Pause';
            stepButton.disabled = true;
            runInterval = setInterval(() => {
                step();
                if (!running) clearInterval(runInterval);
            }, 150);
        }

        function stopRun() {
            if (!running) return;
            running = false;
            clearInterval(runInterval);
            runButton.textContent = 'Run';
            stepButton.disabled = false;
        }

        function reset() {
            stopRun();
            tape = initialTapeString.split('');
            if (tape.length === 0) tape = ['B'];
            headPosition = 0;
            currentState = initialMachineState;
            stepCount = 0;
            updateDisplay();
        }

        // --- Display Functions ---
        function updateDisplay() {
            tapeContainer.innerHTML = '';
            tape.forEach((symbol, index) => {
                const cell = document.createElement('div');
                cell.className = 'tape-cell';
                cell.textContent = symbol;
                if (index === headPosition) cell.classList.add('active');
                tapeContainer.appendChild(cell);
            });
            currentStateDisplay.textContent = currentState;
            stepCountDisplay.textContent = stepCount;
        }

        // --- Event Listeners ---
        initButton.addEventListener('click', initialize);
        binaryButton.addEventListener('click', convertInputToBinary); // New listener
        resetButton.addEventListener('click', reset);
        stepButton.addEventListener('click', step);
        runButton.addEventListener('click', () => {
            if (running) stopRun();
            else run();
        });
        
        window.onload = initialize;
    </script>
</body>
</html>
